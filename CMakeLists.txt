CMAKE_MINIMUM_REQUIRED(VERSION 2.8)

IF(MEMORY MATCHES cnmem)
    ADD_DEFINITIONS(-DDEVICE_MEMORY=0)
ELSEIF(MEMORY MATCHES cuda)
    ADD_DEFINITIONS(-DDEVICE_MEMORY=1)
ELSE()
    ADD_DEFINITIONS(-DDEVICE_MEMORY=2)
ENDIF()

ADD_DEFINITIONS( -DUSE_FLOAT )
IF(TEST_CUDA)
    ADD_DEFINITIONS(-DTEST_CUDA)
ENDIF()

IF(USE_CUDA)
    ADD_DEFINITIONS(-DUSE_GPU)
    INCLUDE_DIRECTORIES(/usr/local/cuda/samples/common/inc)
    FIND_PACKAGE(CUDA REQUIRED)
    FIND_CUDA_HELPER_LIBS(curand)
    SET(CUDA_TOOLKIT_ROOT_DIR ${CUDA_ROOT})
    MESSAGE("CUDA_INCLUDE: " ${CUDA_INCLUDE_DIRS})
    INCLUDE_DIRECTORIES(SYSTEM ${CUDA_INCLUDE_DIRS})
    SET(CUDA_LIBRARIES ${CUDA_LIBRARIES} ${CUDA_curand_LIBRARY})
    MESSAGE("CUDA_LIBRARIES: ${CUDA_LIBRARIES}")
    SET(LIBS ${LIBS} ${CUDA_LIBRARIES})
    INCLUDE_DIRECTORIES(cnmem/include cuda include)
    ADD_SUBDIRECTORY(cnmem)
    ADD_SUBDIRECTORY(cuda)
    SET(LIBS ${LIBS} n3ldg_cuda)
ELSE()
    INCLUDE_DIRECTORIES(include)
ENDIF()
